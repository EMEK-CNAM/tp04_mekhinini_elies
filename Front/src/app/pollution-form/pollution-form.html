<div class="form-container">
    <h2>{{ isEditMode ? 'Modifier la pollution' : 'Nouvelle déclaration' }}</h2>

    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>

    <form [formGroup]="pollutionForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
            <label for="titre">Titre *</label>
            <input id="titre" formControlName="titre" type="text" placeholder="Titre de la pollution" />
        </div>
        <div class="form-group">
            <label for="type_pollution">Type de pollution *</label>
            <select id="type_pollution" formControlName="type_pollution">
                <option value="">-- Sélectionner --</option>
                <option value="Air">Air</option>
                <option value="Eau">Eau</option>
                <option value="Sol">Sol</option>
                <option value="Sonore">Sonore</option>
                <option value="Visuelle">Visuelle</option>
                <option value="Autre">Autre</option>
            </select>
        </div>
        <div class="form-group">
            <label for="lieu">Lieu *</label>
            <input id="lieu" formControlName="lieu" type="text" placeholder="Adresse ou localisation" />
        </div>
        <div class="form-group">
            <label for="date_observation">Date d'observation *</label>
            <input id="date_observation" formControlName="date_observation" type="date" />
        </div>
        <div class="form-group">
            <label for="latitude">Latitude *</label>
            <input id="latitude" formControlName="latitude" type="number" step="0.000001" placeholder="48.8566" />
        </div>
        <div class="form-group">
            <label for="longitude">Longitude *</label>
            <input id="longitude" formControlName="longitude" type="number" step="0.000001" placeholder="2.3522" />
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" formControlName="description" rows="4"
                placeholder="Décrivez la pollution observée"></textarea>
        </div>

        <!-- Upload de photo -->
        <div class="form-group">
            <label for="photo">Photo de la pollution</label>
            <input id="photo" type="file" accept="image/*" (change)="onFileSelected($event)" class="file-input" />
            <p class="help-text">Taille max: 5MB - Formats: JPG, PNG, GIF</p>

            <!-- Aperçu de l'image -->
            <div *ngIf="previewUrl" class="image-preview">
                <img [src]="previewUrl" alt="Aperçu" />
                <button type="button" (click)="removeImage()" class="btn-remove-image">
                    ✕ Supprimer l'image
                </button>
            </div>

            <!-- Barre de progression -->
            <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="progress-bar">
                <div class="progress-fill" [style.width.%]="uploadProgress"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="photo_url">Ou URL de la photo</label>
            <input id="photo_url" formControlName="photo_url" type="url" placeholder="https://..." />
        </div>
        <div class="form-actions">
            <button type="submit" [disabled]="pollutionForm.invalid" class="btn-submit">
                {{ isEditMode ? 'Mettre à jour' : 'Créer' }}
            </button>
            <button type="button" (click)="onCancel()" class="btn-cancel">Annuler</button>
        </div>
    </form>
</div>